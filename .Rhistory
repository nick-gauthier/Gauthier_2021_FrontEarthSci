lapply(list(mod4, mod5, mod6, mod7), glance) %>% bind_rows
lapply(list(mod4, mod5, mod6, mod7), glance) %>% dplyr::bind_rows
lapply(list(mod4, mod5, mod6, mod7), glance) %>% unlist
lapply(list(mod4, mod5, mod6, mod7), glance) %>% rbind
lapply(list(mod4, mod5, mod6, mod7), glance) %>% do.call(rbind, .)
summary(mod4)
summary(mod5)
summary(mod6)
summary(mod7)
summary(mod6)
mod9 <- gam(weight ~ s(lcp, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
mod9 <- gam(weight ~ s(lcp, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
mod2 <- gam
glance(mod9)
mod9 <- gam(weight ~ s(lcp, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
mod9 <- gam(weight ~ s(lcp, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
glance(mod9)
lapply(list(mod4, mod5, mod6, mod7), glance) %>% do.call(rbind, .)
mod6 <- gam(weight ~ eof2.b +
s(lcp, bs = 'cr') +
s(water.stress, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof3, by = eof3.b, bs = 'cr') +
s(eof4, by = eof4.b, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
lapply(list(mod4, mod5, mod6, mod7), glance) %>% do.call(rbind, .)
mod1 <- gam(weight ~ eof2.b + eof3.b +eof4.b +eof5.b +eof6.b +
s(lcp, bs = 'cr') +
s(ws, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof2, by = eof2.b, bs = 'cr') +
s(eof3, by = eof3.b, bs = 'cr') +
s(eof4, by = eof4.b, bs = 'cr') +
s(eof5, by = eof5.b, bs = 'cr') +
s(eof6, by = eof6.b, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', select = T, data = dat)
mod1 <- gam(weight ~ eof2.b + eof3.b +eof4.b +eof5.b +eof6.b +
s(lcp, bs = 'cr') +
s(ws, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof2, by = eof2.b, bs = 'cr') +
s(eof3, by = eof3.b, bs = 'cr') +
s(eof4, by = eof4.b, bs = 'cr') +
s(eof5, by = eof5.b, bs = 'cr') +
s(eof6, by = eof6.b, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', select = T, data = dat)
glance(mod1)
plot(mod1, pages = 1)
summary(mod1)
c(T,F) %>% numeric
c(T,F) %>% as.numeric
tidy(mod1)
plot(mod1, pages = 1)
dat$eof3.b %>% hist
dat$eof3.b %>% sum
dat$eof3.b
dat$eof3.b %>% tt
dat$eof3.b %>% table
dat$eof4.b %>% table
dat$eof3.b %>% table
dat$eof6.b %>% table
dat$eof6.b %>% as.character %>% as.numeric
dat$eof6.b %>% as.character %>% as.numeric %>% hist
dat$eof5.b %>% as.character %>% as.numeric %>% hist
dat$eof4.b %>% as.character %>% as.numeric %>% hist
dat$eof3.b %>% as.character %>% as.numeric %>% hist
dat$eof3.b %>% as.character %>% as.numeric %>% hist
dat$eof5.b %>% as.character %>% as.numeric %>% hist
dat$eof4.b %>% as.character %>% as.numeric %>% hist
mod2 <- gam(weight ~ eof3.b + eof5.b  +
s(lcp, bs = 'cr') +
s(ws, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof2, bs = 'cr') +
s(eof3, by = eof3.b, bs = 'cr') +
s(eof4, by = eof4.b, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', select = T, data = dat)
plot(mod2, pages = 1)
glance(mod2)
summary(mod2)
plot(mod2, pages = 1)
mod2 <- gam(weight ~ eof3.b + eof5.b  +
s(lcp, bs = 'cr') +
s(water.stress, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof2, bs = 'cr') +
s(eof3, by = eof3.b, bs = 'cr') +
s(eof4, by = eof4.b, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
mod2 <- gam(weight ~ eof3.b + eof5.b  +
s(lcp, bs = 'cr') +
s(water.stress, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof2, bs = 'cr') +
s(eof3, by = eof3.b, bs = 'cr') +
s(eof4, by = eof4.b, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
mod3 <- gam(weight ~ eof3.b +
s(lcp, bs = 'cr') +
s(water.stress, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof2, bs = 'cr') +
s(eof3, by = eof3.b, bs = 'cr') +
s(eof4, by = eof4.b, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
mod4 <- gam(weight ~ s(lcp, bs = 'cr') +
s(water.stress, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof3, bs = 'cr') +
s(eof4, by = eof4.b, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
plot(mod2, pages = 1)
glance(mod2)
summary(mod2)
```
lapply(list(c(mod2, mod3, mod4))) %>% glance %>% do.call(rbind, .)
lapply(list(mod2, mod3, mod4), glance) %>% do.call(rbind, .)
plot(mod2, pages = 1)
plot(mod3, pages = 1)
plot(mod4, pages = 1)
mod5 <- gam(weight ~ eof3.b + eof5.b  +
s(lcp, bs = 'cr') +
s(water.stress, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof3, by = eof3.b, bs = 'cr') +
s(eof4, by = eof4.b, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
mod5 <- gam(weight ~ eof3.b + eof5.b  +
s(lcp, bs = 'cr') +
s(water.stress, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof3, by = eof3.b, bs = 'cr') +
s(eof4, by = eof4.b, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
lapply(list(mod2, mod3, mod4), glance) %>% do.call(rbind, .)
plot
lapply(list(mod2, mod3, mod4, mod5), glance) %>% do.call(rbind, .)
plot(mod5, pages = 1)
EvaluateSmooths = function(model, select=NULL, x=NULL, n=100) {
if (is.null(select)) {
select = 1:length(model$smooth)
}
do.call(rbind, lapply(select, function(i) {
smooth = model$smooth[[i]]
data = model$model
if (is.null(x)) {
min = min(data[smooth$term])
max = max(data[smooth$term])
x = seq(min, max, length=n)
}
if (smooth$by == "NA") {
by.level = "NA"
} else {
by.level = smooth$by.level
}
range = data.frame(x=x, by=by.level)
names(range) = c(smooth$term, smooth$by)
mat = PredictMat(smooth, range)
par = smooth$first.para:smooth$last.para
y = mat %*% model$coefficients[par]
se = sqrt(rowSums(
(mat %*% model$Vp[par, par, drop = FALSE]) * mat
))
return(data.frame(
label=smooth$label
, x.var=smooth$term
, x.val=x
, by.var=smooth$by
, by.val=by.level
, value = y
, se = se
))
}))
}
smooths = EvaluateSmooths(mod5)
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_grid(. ~ x.var)
library(ggplot2)
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_grid(. ~ x.var)
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_grid(. ~ x.var, scale = 'free_x')
mod6 <- gam(weight ~ s(lcp, bs = 'cr') +
s(water.stress, bs = 'cr') +
s(elev, bs = 'cr') +
s(eof3, bs = 'cr') +
s(eof4, bs = 'cr'),
family=betar(link="logit"),
method = 'REML', data = dat)
lapply(list(mod2, mod3, mod4, mod5, mod6), glance) %>% do.call(rbind, .)
smooths = EvaluateSmooths(mod6)
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_grid(. ~ x.var, scale = 'free_x') +
theme_minimal()
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_grid(. ~ x.var, scale = 'free_x') +
theme_bw()
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_wrap(. ~ x.var, scale = 'free_x') +
theme_bw()
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_wrap(. ~ x.var, scale = 'free_x', nrow = 2) +
theme_bw()
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_wrap(. ~ x.var, scales = 'free_x', nrow = 2) +
theme_bw()
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_wrap(~ x.var, scales = 'free_x', nrow = 2) +
theme_bw()
gam.names <- c(`lcp` = "Travel time (hours)",
`water.stress` = "Water stress (mm)",
`elev` = "Elevation (m)",
`eof3` = "EOF3",
`eof4` = "EOF4"
)
gam.names <- c(`lcp` = "Travel time (hours)",
`water.stress` = "Water stress (mm)",
`elev` = "Elevation (m)",
`eof3` = "EOF3",
`eof4` = "EOF4"
)
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_wrap(~ x.var, scales = 'free_x', nrow = 2), labeller = as_labeller(gam.names)+
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_wrap(~ x.var, scales = 'free_x', nrow = 2, labeller = as_labeller(gam.names)) +
labs(main = 'Predictors of tie strength', subtitle = 'Generalized additive model smooths and standard errors') +
theme_bw() +
theme(strip.background = element_blank())
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_wrap(~ x.var, scales = 'free_x', nrow = 2, labeller = as_labeller(gam.names)) +
labs(title = 'Predictors of tie strength', subtitle = 'Generalized additive model smooths and standard errors') +
theme_bw() +
theme(strip.background = element_blank())
ggsave('smooths.pdf')
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_wrap(~ x.var, scales = 'free_x', nrow = 2, labeller = as_labeller(gam.names)) +
labs(title = 'Predictors of tie strength', subtitle = 'Generalized additive model smooths and standard errors') +
theme_bw() +
theme(strip.background = element_blank())
ggsave('smooths.pdf', width = 6, height = 4.5)
ggplot(smooths, aes(x.val, value)) +
geom_line() +
geom_line(aes(y=value + 2*se), linetype="dashed") +
geom_line(aes(y=value - 2*se), linetype="dashed") +
facet_wrap(~ x.var, scales = 'free_x', nrow = 2, labeller = as_labeller(gam.names)) +
labs(title = 'Predictors of tie strength', subtitle = 'Generalized additive model smooths and standard errors', x = '', y = '') +
theme_bw() +
theme(strip.background = element_blank())
ggsave('smooths.pdf', width = 6, height = 4.5)
library(GGally)
library(ggmap)
library(maps)
library(maptools)
states <- map('state', regions = c('arizona', 'new mexico'), fill = T, plot = F)
IDs <- sapply(strsplit(states$names, ":"), function(x) x[1])
states.ply <- map2SpatialPolygons(states, IDs=IDs)
plotEOF <- function(x){
rasterVis::gplot(x) +
geom_raster(aes(fill = value), na.rm = T, show.legend = F) +
scale_fill_distiller(palette = 'RdBu', na.value = NA) +
geom_polygon(data = states, aes(x = long, y = lat, group = region), color = 'black', fill = NA) +
coord_quickmap() +
theme_minimal() +
labs(x = "Longitude", y = "Latitude")
}
eof1200 <- brick('Data/eof1200.nc')[[3]] %>%
mask(states.ply) %>%
plotEOF
eof1200
brick('Data/eof1200.nc')[[3]]
brick('Data/eof1200.nc')[[3]] %>%
mask(states.ply)
eof1200
brick('Data/eof1250.nc')[[3]] %>%
mask(states.ply)
ggnetworkmap(eof1200, ad1200, great.circles = T, size = .5, segment.alpha = I(.5))
eof1200
brick('Data/eof1200.nc')[[3]] %>%
mask(states.ply)
rasterVis::gplot(x) +
geom_raster(aes(fill = value), na.rm = T, show.legend = F) +
scale_fill_distiller(palette = 'RdBu', na.value = NA, limits = c(-.3,.3)) +
geom_polygon(data = states, aes(x = long, y = lat, group = region), color = 'black', fill = NA) +
coord_quickmap() +
theme_minimal() +
labs(x = "Longitude", y = "Latitude")
plotEOF <- function(x){
rasterVis::gplot(x) +
geom_raster(aes(fill = value), na.rm = T, show.legend = F) +
scale_fill_distiller(palette = 'RdBu', na.value = NA, limits = c(-.3,.3)) +
geom_polygon(data = states, aes(x = long, y = lat, group = region), color = 'black', fill = NA) +
coord_quickmap() +
theme_minimal() +
labs(x = "Longitude", y = "Latitude")
}
eof1200 <- brick('Data/eof1200.nc')[[3]] %>%
mask(states.ply) %>%
plotEOF
eof1200
brick('Data/eof1300.nc')[[3]] %>%
mask(states.ply)
brick('Data/eof1350.nc')[[3]] %>%
mask(states.ply)
swsn.pts <- read_csv('Data/attributes_orig.csv') %>%
select(easting = EASTING, northing = NORTHING) %>%
SpatialPoints(proj4string=CRS("+proj=utm +zone=12 +datum=WGS84")) %>%
spTransform(CRS("+proj=longlat +datum=WGS84")) %>%
coordinates %>%
data.frame
ad1200 <- readSWSN('Data/AD1200sim.csv')
readSWSN <- function(net){
net.in <- read.csv(net, row.names = 1, check.names = F) %>%
as.matrix %>%
graph_from_adjacency_matrix(mode = 'undirected', weighted = T, diag = F)
ord <- match(V(net.in)$name, swsn.attr$site)
V(net.in)$lon <- swsn.attr[ord, 6]
V(net.in)$lat <- swsn.attr[ord, 7]
V(net.in)$size <- swsn.attr[ord, 5]
V(net.in)$region <- swsn.attr[ord, 3] %>% as.character
return(net.in)
}
ad1200 <- readSWSN('Data/AD1200sim.csv')
ad1250 <- readSWSN('Data/AD1250sim.csv')
ad1300 <- readSWSN('Data/AD1300sim.csv')
ad1350 <- readSWSN('Data/AD1350sim.csv')
ad1400 <- readSWSN('Data/AD1400sim.csv')
ad1200.t=delete.edges(ad1200, which(E(ad1200)$weight <=.5)) # here's my condition.
detach(igraph)
detach(network)
ad1200.t=igraph::delete.edges(ad1200, which(E(ad1200)$weight <=.5)) # here's my condition.
ad1200.t=igraph::delete.edges(ad1200, which(E(ad1200)$weight <=.5)) %>% igraph::delete.vertices(which(degree(.)<1))
e1 <- ggnetworkmap(eof1200, ad1200.t, great.circles = T, size = .5, segment.alpha = I(.5)) + geom_label(x = -106, y = 35, label = 'AD 1200')
e1 <- ggnetworkmap(eof1200, ad1200.t, great.circles = T, size = .5, segment.alpha = I(.5)) + geom_label(x = -106, y = 35, label = 'AD 1200')
e1
ad1200.t=igraph::delete.edges(ad1200, which(E(ad1200)$weight <=.75)) %>% igraph::delete.vertices(which(degree(.)<1))
ad1200.t=igraph::delete.edges(ad1200, which(E(ad1200)$weight <=.75))
ggnetworkmap(eof1200, ad1200.t, great.circles = T, size = .5, segment.alpha = I(.5)) + geom_label(x = -106, y = 35, label = 'AD 1200')
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight, alpha = weight)) +
geom_node_point() +
scale_edge_color_distiller(palette = 'YlOrRd') +
scale_edge_alpha()+
coord_fixed()+
theme_void()
library(ggraph)
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight, alpha = weight)) +
geom_node_point() +
scale_edge_color_distiller(palette = 'YlOrRd') +
scale_edge_alpha()+
coord_fixed()+
theme_void()
net.in <- read.csv("Data/AD1200sim.csv", row.names = 1, check.names = F)
net.in[net.in < .9] <- 0
net.in <- net.in %>%
as.matrix %>%
graph_from_adjacency_matrix(mode = 'undirected', weighted = T, diag = F)
V(net.in)$deg <- degree(net.in)
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight, alpha = weight)) +
geom_node_point() +
scale_edge_color_distiller(palette = 'YlOrRd') +
scale_edge_alpha()+
coord_fixed()+
theme_void()
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight, alpha = weight)) +
geom_node_point() +
scale_edge_color_distiller(palette = 'YlOrRd', direction = F) +
scale_edge_alpha()+
coord_fixed()+
theme_void()
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight, alpha = weight)) +
geom_node_point(aes(size = deg)) +
scale_edge_color_distiller(palette = 'YlOrRd', direction = F) +
scale_edge_alpha()+
coord_fixed()+
theme_void()
V(net.in)$deg <-igraph::degree(net.in)
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight, alpha = weight)) +
geom_node_point(aes(size = deg)) +
scale_edge_color_distiller(palette = 'YlOrRd', direction = F) +
scale_edge_alpha()+
coord_fixed()+
theme_void()
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight, alpha = weight)) +
#geom_node_point(aes(size = deg)) +
scale_edge_color_distiller(palette = 'YlOrRd', direction = F) +
scale_edge_alpha()+
coord_fixed()+
theme_void()
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight, alpha = weight)) +
#geom_node_point(aes(size = deg)) +
scale_edge_color_distiller(palette = 'YlOrRd', direction = F, guide = 'legend') +
scale_edge_alpha(guide = 'none')+
coord_fixed()+
theme_void()
logit<-function(x) log(x/(1-x))
E(net.in)$weight.l <- logit(E(net.in)$weight)
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight.l, alpha = weight.l)) +
#geom_node_point(aes(size = deg)) +
scale_edge_color_distiller(palette = 'YlOrRd', direction = F, guide = 'legend') +
scale_edge_alpha(guide = 'none')+
coord_fixed()+
theme_void()
weight.l
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight.l, alpha = weight)) +
#geom_node_point(aes(size = deg)) +
scale_edge_color_distiller(palette = 'YlOrRd', direction = F, guide = 'legend') +
scale_edge_alpha(guide = 'none')+
coord_fixed()+
theme_void()
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight, alpha = weight)) +
#geom_node_point(aes(size = deg)) +
scale_edge_color_distiller(palette = 'YlOrRd', direction = F, guide = 'legend') +
scale_edge_alpha(guide = 'none')+
coord_fixed()+
theme_void()
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = log(weight), alpha = weight)) +
#geom_node_point(aes(size = deg)) +
scale_edge_color_distiller(palette = 'YlOrRd', direction = F, guide = 'legend') +
scale_edge_alpha(guide = 'none')+
coord_fixed()+
theme_void()
ggraph(net.in, 'circle') +
geom_edge_link(aes(color = weight, alpha = weight)) +
#geom_node_point(aes(size = deg)) +
scale_edge_color_viridis(guide = 'legend') +
scale_edge_alpha(guide = 'none')+
coord_fixed()+
theme_void()
knitr::opts_chunk$set(echo = TRUE)
library(remote)
install.packages("remote")
knitr::opts_chunk$set(echo = TRUE)
install_github('marchtaylor/sinkr')
library(devtools)
library(sinkr)
library(devtools)
install_github('marchtaylor/sinkr')
library(sinkr)
rm(e1)
rm(eof1200)
rm(elev)
rm(c(b,b3))
rm(b,b3)
rm(ad21200.t)
