---
title: "Southwest Climate Variability"
author: "Nicolas Gauthier"
output: html_notebook
---

```{r}
library(magrittr)
library(raster)
library(rasterVis)
```

Get elevation data and crop to the extend of the US Southwest. Use this map to help crop and reproject other data.

```{r}
elev <- getData('alt', country = 'USA') %>% extract2(1) %>% crop(extent(c(-113, -106, 31, 38)))
levelplot(elev, margin = F)
```

We'll be using the Daymet climate data to represent observed values. Load devtools and install the DaymetR package from github, allowing us to directly download data using R. https://khufkens.github.io/daymetr/

```{r}
require(devtools)
install_github("khufkens/daymetr") # install the package
library(daymetr) # load the package
```
Download daymet data using the code below. This takes a while, so we assume you've already downloaded daymet data and it is living in ~/gdrive/Data/Daymet/
```{r, eval=FALSE, include=FALSE}
download.daymet.tiles(lat1=38,lon1=-113,lat2=31,lon2=-106,start_yr=1980,end_yr=2014,param='prcp')
```

```{r}
test <- brick('~/gdrive/Data/Daymet/prcp_1982_10834.nc')
levelplot(test[[8]], margin = F)
```

```{r}
library(parallel)
files <- list.files('~/gdrive/Data/Daymet', full.names = T)

daymet <- mclapply(seq(1,137,4), function(x){
  l <- merge(brick(files[x]),brick(files[x+1]),brick(files[x+2]),brick(files[x+3]))
})
```

